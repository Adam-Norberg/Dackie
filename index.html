<!DOCTYPE html> <!-- is this even necessary?-->
<!--
TODO:
* Add tracklist to change songs
* Seperate html, css and javascript since this file is a hellhole
-->
<html>
    <head>
        <title>Dackie</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device.width">
        <!-- Favicon bullshit -->
        <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
        <link rel="manifest" href="favicon/site.webmanifest">
        <link rel="mask-icon" href="favicon/safari-pinned-tab.svg" color="#5bbad5">
        <meta name="msapplication-TileColor" content="#da532c">
        <meta name="theme-color" content="#ffffff">
        <!-- Favicon bullshit -->
        <!-- API-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
        <style>
        body{
            font-family: Bahnschrift, Corbel, 'Segoe UI';
            background-color: #ba9bcc;
            text-align: center;
        }
        footer {
            font-family: sans-serif;
            color: gray;
            text-align: center;
            font-size: 12px;
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
        }
        img {
            width: 35%;
            height: auto;
        }
        #reimu { /* No clue how or why this shit works */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        </style>
    </head>
    <body id="mage">
        <h1 id="rubrik" style="color: #6b6b6b; opacity:0"><b>Dackie</b></h1>
        <p id="undertext" style="color: #7F7F7F; opacity:0"><i>My own personal hell</i></p>
        <div style="display:inline-block">
        <button onclick="funkyButton()" id="funky" style="display:none;">Jam'</button>
        <button onclick="settings()" id="settingsbutton" style="opacity:0">⛭</button>
        <button onclick="increase()" id="increasevolume" style="opacity:0">↑</button>
        <button onclick="decrease()" id="decreasevolume" style="opacity:0">↓</button>
        </div>
        <img id="reimu" src="images/reimu.gif" alt="Reimu spinning" style="opacity:0;">
        <p id="counter" style="opacity:0"></p>
        <audio onended="smoothrepeat()" id="funkymusic">
            <source src="music/funky.mp3" type="audio/mpeg">
            Your browser does not support mp3.
        </audio>
    </body>
    <script>
        var music = document.getElementById("funkymusic");
        var musicvolume=0.1; //Start at low to avoid loud shit
        var time = 0;

        function funkyButton(){ //Button function to play music and play gif, and rainbow background
            var element = document.getElementById("funky");
            if(element.innerHTML === "Jam'"){ //Reads button text for start / stop determination
                element.innerHTML = 'Stop'; //Sets text to stop so same button can be used for both.
                $("#reimu").fadeTo(2000,1);
                setTimeout(function(){$("#settingsbutton").fadeTo(1000,1)},3500);
                smoothrepeat();
                backgroundWave(true);
                timer(true);
            }
            else{ //when button text is "stop" and is pressed, fades out music and gif and reverts background.
                element.innerHTML = "Jam'";
                $("#reimu").fadeOut(3000);
                $("#funkymusic").animate({volume: 0.0},3000);
                $("#funkymusic").finish(true,true);
                setTimeout(function(){music.pause();},3000);
                backgroundWave(false);
                timer(false);
            }
        }
        function smoothrepeat(){ //Self explanatory but still took several fucking hours somehow
            music.load();
            music.play();
            music.volume=0.0;
            $("#funkymusic").animate({volume: musicvolume},3000); //Smooth start
            setTimeout(function(){$("#funkymusic").animate({volume: 0.0},3000);},136000); //Smooth end
        }
        
        function backgroundWave(getstate){ //Clusterfuck abomination but it works so i'll use it
            var delay = 1500; //1.5sec between each transition
            if(getstate){ //Rainbow wave
                $("#mage").animate({
                    backgroundColor: "rgb(155,155,204)"
                },delay, function(){
                    $("#mage").animate({
                        backgroundColor: "rgb(155,204,204)"
                    },delay, function(){
                        $("#mage").animate({
                            backgroundColor: "rgb(155,204,155)"
                        },delay, function(){
                            $("#mage").animate({
                                backgroundColor: "rgb(204,204,155)"
                            },delay, function(){
                                $("#mage").animate({
                                    backgroundColor: "rgb(204,155,155)"
                                },delay, function(){
                                    $("#mage").animate({
                                        backgroundColor: "rgb(204,155,204)"
                                    },delay, function(){
                                        $("#mage").animate({
                                            backgroundColor: "rgb(186,155,204)"
                                        },delay, backgroundWave(true));
                                    });
                                });
                            });
                        });
                    });
                });
            }
            else{ //Halts animation, and animates back to original #ba9bcc in rgb
                $("#mage").stop(false,false).animate({
                    backgroundColor: "rgb(186,155,204)"
                },3000);
            }
        }

        function timer(getstate){ //Self explanatory
            if(getstate){
                var element = document.getElementById("counter");
                setTimeout(function(){$("#counter").fadeTo(3000,1)},2000);
                counter = setInterval(function(){
                    time++;
                    element.innerHTML=time.toString();
                },1000);
            }
            else{
                clearInterval(counter);
                setTimeout(function(){$("#counter").fadeOut(2000,0)},3000); //Did you notice i like fading shit?
            }
        }
        var setstate=true;
        function settings(){
            if(setstate){
                $("#increasevolume").fadeTo(1000,1);
                setTimeout(function(){$("#decreasevolume").fadeTo(1000,1)},750);
                setstate = !setstate;
            }
            else{
                setTimeout(function(){$("#increasevolume").fadeOut(1000,0)},750);
                $("#decreasevolume").fadeOut(1000,0);
                setstate = !setstate;
            }
        }
        function increase(){
            musicvolume+=0.05;
            $("#funkymusic").animate({volume: music.volume+0.05},1000);
        }
        function decrease(){
            musicvolume-=0.05;
            $("#funkymusic").animate({volume: music.volume-0.05},1000);
        }

        $(document).ready(function(){
            $('#rubrik').fadeTo(2500,1,function(){ //Dackie text at top
                $('#undertext').fadeTo(2500,1,function(){ //The text underneath
                    $('#funky').slideDown(1500); // Funky Button 
                });
            });
        });
    </script>
    <footer>
        <i>2021 - <a href="https://twitter.com/zxz_regular" target="_blank">Dackie</a></i> <!-- Sellout -->
    </footer>
</html>